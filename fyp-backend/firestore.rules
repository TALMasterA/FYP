rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {

    // ============================================
    // EXISTING RULE: User Data (Your current rule - PRESERVED)
    // Users can only access their own data
    // ============================================
    match /users/{userId}/{document=**} {
      allow read, write: if request.auth != null && request.auth.uid == userId;
    }

    // ============================================
    // NEW: Feedback Collection (For feedback feature)
    // Authenticated users can submit feedback
    // ============================================
    match /feedback/{feedbackId} {
      // Allow authenticated users to create feedback
      allow create: if request.auth != null
                    && request.resource.data.userId == request.auth.uid
                    && request.resource.data.message is string
                    && request.resource.data.message.size() > 0
                    && request.resource.data.message.size() <= 5000;

      // Feedback is write-only for users (only admins should read - not implemented yet)
      allow read, update, delete: if false;
    }

    // ============================================
    // DEFAULT: Deny all other access
    // ============================================
    match /{document=**} {
      allow read, write: if false;
    }
  }
}

